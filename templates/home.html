{% extends "base.html" %}
{% block content %}
<section class="controls">
  <form method="get" action="{{ url_for('home') }}" class="search-form">
    <input type="text" name="q" placeholder="Search title or author..." value="{{ q or '' }}">
    <select name="sort">
      <option value="">Sort by…</option>
      <option value="title" {{ 'selected' if sort=='title' else '' }}>Title</option>
      <option value="year" {{ 'selected' if sort in ['year','publication_year'] else '' }}>Year</option>
      <option value="author" {{ 'selected' if sort=='author' else '' }}>Author</option>
    </select>
    <select name="direction">
      <option value="asc" {{ 'selected' if direction!='desc' else '' }}>Asc</option>
      <option value="desc" {{ 'selected' if direction=='desc' else '' }}>Desc</option>
    </select>
    <button type="submit">Apply</button>
    {% if q %}
      <a href="{{ url_for('home') }}" class="btn-link">Reset</a>
    {% endif %}
  </form>
</section>

<section class="two-col">
  <div class="col">
    <h2>Books</h2>
    {% if books %}
      <ul class="card-list">
        {% for book in books %}
          <li class="card">
            <div class="card-title">{{ book.title }}</div>
            <div class="card-sub">{{ book.author.name if book.author else '—' }}</div>
            <div class="meta">
              <span>Year: {{ book.publication_year }}</span>
              {% if book.isbn %}<span>ISBN: {{ book.isbn }}</span>{% endif %}
            </div>
            <div class="actions">
              <a class="btn" href="{{ url_for('update', book_id=book.id) }}">Edit</a>
              <form method="post" action="{{ url_for('delete_book', book_id=book.id) }}" onsubmit="return confirm('Delete this book?')" style="display:inline;">
                <button class="btn danger" type="submit">Delete</button>
              </form>
            </div>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p>No books yet.</p>
    {% endif %}
  </div>

  <div class="col">
    <h2>Authors</h2>
    {% if authors %}
      <ul class="list">
        {% for a in authors %}
          <li>
            <strong>{{ a.name }}</strong>
            {% if a.birth_date %}
              <span> ({{ a.birth_date }})</span>
            {% endif %}
            {% if a.date_of_death %}
              <span> – {{ a.date_of_death }}</span>
            {% endif %}
            {% if a.books %}
              <div class="subtle">Books: {{ a.books|length }}</div>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p>No authors yet.</p>
    {% endif %}
  </div>
</section>
{% endblock %}